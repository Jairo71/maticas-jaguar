
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I learn math</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://drive.google.com/thumbnail?id=1kHsPdkw6Tq4MsocpIqixwhsidsGqKcfU">
    <meta name="theme-color" content="#ffffff">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@400;700&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            overscroll-behavior-y: contain;
        }

        .title-stroke {
            font-family: 'Fredoka One', cursive;
            -webkit-text-stroke: 2px #FBBF24; /* yellow-400 */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .fraction {
            display: inline-flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 0.2em;
            vertical-align: middle;
        }

        .fraction > span {
            display: block;
            padding: 0 0.3em;
        }

        .fraction > .denominator {
            border-top: 2px solid currentColor;
        }
        
        .mixed-number {
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const quizData = [
            {
                id: 'numeros-recta',
                title: 'Números en la Recta',
                icon: 'https://drive.google.com/thumbnail?id=1ww5d2iV5zgWlo7UBVFjlYX57u9KgCOiR',
                theme: {
                    bg: 'bg-indigo-500',
                    text: 'text-white',
                    accent: 'bg-indigo-700',
                    button: 'bg-indigo-600 hover:bg-indigo-800',
                    card: 'bg-indigo-600',
                    ring: 'ring-indigo-300'
                },
                questions: [
                    { question: 'Observa la siguiente recta numérica. ¿A que fracción corresponde la longitud del segmento azul si A es igual a 1?', options: ['a) 3/5', 'b) 7/10', 'c) 1/2', 'd) 7/8'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1-X5BsH-D12S_VGN9RCHGrChPVC5cHGiW' },
                    { question: 'Observa la siguiente recta numérica. ¿A que fracción corresponde la longitud del segmento azul si B es igual a 1?', options: ['a) 7/14', 'b) 1/2', 'c) 7/8', 'd) 7/10'], correct: 0, image: 'https://drive.google.com/thumbnail?id=1wR-teorlaVAyg6KiG9DeDpK2-tHPww1N' },
                    { question: 'Observa la siguiente recta numérica. ¿A que fracción corresponde la longitud del segmento azul si C es igual a 1?', options: ['a) 1/2', 'b) 3/5', 'c) 7/18', 'd) 7/8'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1q8uHin33S_NiGH0Nsjbuu1kuhWPphdhB' },
                    { question: '¿Cuál es el número decimal indicado por la flecha roja en la recta numérica?', options: ['a) 5.91', 'b) 5.99', 'c) 5.19', 'd) 5.999'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1H2ih_vHz79LIWf5U1J6L7qH6FA5Kxvvd' },
                    { question: 'En la siguiente recta numérica, ¿qué número mixto representa la ubicación de la flecha azul?', options: ['a) 1 2/10', 'b) 1 1/6', 'c) 1 1/4', 'd) 1 1/8'], correct: 0, image: 'https://drive.google.com/thumbnail?id=1IUk5QLx_AlMvxxiyVfFsy5Vhg7ks-_tP' },
                    { question: 'Observa la figura. ¿Qué fracción, en su forma más simple, representa la parte pintada?', options: ['a) 3/6', 'b) 3/5', 'c) 2/3', 'd) 1/2'], correct: 3, image: 'https://drive.google.com/thumbnail?id=1SLaooaOe1fgKWTiD15X6FAVW9G9OQE0E' },
                    { question: '¿Cuál es el número que corresponde al punto señalado con la flecha azul?', options: ['a) 2/3', 'b) 2/5', 'c) 3 1/3', 'd) 0.66'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1bDsAA0UnD0IQPc9RxOOzrMUt0Ywdmxfy' },
                    { question: '¿Qué número decimal representa el punto k en la recta numérica?', options: ['a) 6.7', 'b) 6 7/10', 'c) 6.07', 'd) 6.71'], correct: 2, image: 'https://drive.google.com/thumbnail?id=19oNgpuL7_MGVnepAZXfnIGEBiTekpcqp' },
                    { question: '¿Qué número mixto representa la flecha en la recta numérica?', options: ['a) 3.35', 'b) 3 345/1000', 'c) 3.5', 'd) 3 35/100'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1pc-K5q-NthQGySH-X9aHjFjBd6P_h2_m' },
                    { question: '¿Qué números mixtos representan las flechas en la recta numérica?', options: ['a) 2 3/4 y 3 3/10', 'b) 2 4/10 y 3 3/4', 'c) 2 4/10 y 3 6/10', 'd) 2 4/10 y 3 8/10'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1r0QmLKejM4slwvh6Rjrl0o9ELZXCFP-F' }
                ]
            },
            {
                id: 'sucesiones',
                title: 'Sucesiones',
                icon: 'https://drive.google.com/thumbnail?id=1oXgdQfi4z2wIlcQM8gkd1yctIRosFj6a',
                theme: {
                    bg: 'bg-yellow-500',
                    text: 'text-gray-800',
                    accent: 'bg-yellow-600',
                    button: 'bg-yellow-400 hover:bg-yellow-600',
                    card: 'bg-yellow-400',
                    ring: 'ring-yellow-300'
                },
                questions: [
                    { question: '¿Cuántos cuadritos tendrá la figura 6?', options: ['a) 25', 'b) 27', 'c) 23', 'd) 24'], correct: 0, image: 'https://drive.google.com/thumbnail?id=1fShUMc7DFJc0s2EWxMse_HMCJUxy_Rl-' },
                    { question: '¿Cuántos círculos tendrá la figura 7?', options: ['a) 19', 'b) 22', 'c) 23', 'd) 24'], correct: 1, image: 'https://drive.google.com/thumbnail?id=13AudCE57GqFf61JlVULXyOKGN5Bi3gCa' },
                    { question: '¿Cuál es la regla para encontrar el número de cuadritos que tendrá la figura n?', options: ['a) n²', 'b) n + 2', 'c) 2n - 1', 'd) 3n - 2'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1-gILkSfzliMdXyRLZL_7Adxdbkswxq-r' },
                    { question: '¿Cuántos puntos tendrá la figura numero 10?', options: ['a) 38', 'b) 39', 'c) 40', 'd) 41'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1GNEcXFDc2bIwO4Hs44QlWXFHoXIkI_sJ' },
                    { question: '¿Cuál es la regla para encontrar el número de triángulos iguales que tendrá la figura n?', options: ['a) 3n - 1', 'b) n(n+1)', 'c) n²', 'd) 2n'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1R0XRs4GWaa0ZiWix6tuaqNv-0chyJGQ_' },
                    { question: '¿Cuál es la regla para encontrar el número de cubos que tendrá la figura n?', options: ['a) 2n', 'b) 2n+1', 'c) 3n-1', 'd) 4n-2'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1zFYtsrBODmmIE_nNLDrjKfQWhMYIignr' },
                    { question: '¿Cuántos puntos tendrá la figura 9 para seguir la secuencia?', options: ['a) 43', 'b) 44', 'c) 45', 'd) 46'], correct: 3, image: 'https://drive.google.com/thumbnail?id=1XxxK5RddIX69OERTLt3tNdzru9v4kJ-N' },
                    { question: '¿Cuál es la expresión algebraica que se usó para completar la tabla?', options: ['a) e=3f-1', 'b) e=3f', 'c) e=3f+2', 'd) e=3f+1'], correct: 2, image: 'https://drive.google.com/thumbnail?id=10us2shyn2oFalegQFXrnyYOeVvJ0nzvC' },
                    { question: '¿Cuál es la expresión algebraica que se usó para completar la tabla?', options: ['a) p=2n-1', 'b) p=2n+1', 'c) p=2n+2', 'd) p=n+1'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1HeNAudFRHmJaz_BQPgU4ixMaF_cf3-l6' },
                    { question: '¿Cuál es la expresión algebraica que se usó para completar la tabla?', options: ['a) y=3x-1', 'b) y=3x+5', 'c) y=3x+2', 'd) y=x+4'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1vjxZbI8Y7OucL3ejrPTD83yKdjti9KEp' }
                ]
            },
            {
                id: 'perimetros',
                title: 'Perímetros de Figuras',
                icon: 'https://drive.google.com/thumbnail?id=1DnLCVx4QPZ0rm1bP8RL8gFKOmVn78P-N',
                theme: {
                    bg: 'bg-green-500',
                    text: 'text-white',
                    accent: 'bg-green-700',
                    button: 'bg-green-600 hover:bg-green-800',
                    card: 'bg-green-600',
                    ring: 'ring-green-300'
                },
                questions: [
                    { question: '¿Cuál es la expresión para el perímetro de la figura?', options: ['a) 8m+2mn+n', 'b) 8m+4n', 'c) 5n+4m+n', 'd) 10m+4n'], correct: 3, image: 'https://drive.google.com/thumbnail?id=1zne2lDF4aFNrpGoDj-mKVSVV7uH1wXjh' },
                    { question: '¿Cuál es la expresión para el perímetro de la figura?', options: ['a) 16y +11', 'b) 16y +12', 'c) 16y + 18', 'd) 16y +19'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1nEIzQJrlyI0MlA3NMhI3RLKJ6sET-MYh' },
                    { question: '¿Cuál es la expresión para el perímetro de la figura?', options: ['a) 6x +7', 'b) 6x + 14', 'c) 6x +10', 'd) 5x + 12'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1dhLPO6b_mmUeA6hGoSCAbDzX3x0pgRdz' },
                    { question: '¿Cuál es la expresión para el perímetro de la figura?', options: ['a) 8x + 10', 'b) 8x + 11', 'c) 8x +6', 'd) 8x + 12'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1X0wvjdku0sLDLeryfobbXHSAbJc5AaQt' },
                    { question: '¿Cuál es la expresión para el perímetro de la figura?', options: ['a) 7x + 8', 'b) 7x - 8', 'c) 7x +6', 'd) 7x + 7'], correct: 0, image: 'https://drive.google.com/thumbnail?id=1gtTH58QJk_dx7JAyivuggvGn26Q5lyVG' },
                    { question: '¿Cuánto mide el perímetro de la figura, considera π=3.14?', options: ['a) 21.56 cm', 'b) 27.85 cm', 'c) 24.13 cm', 'd) 23.75 cm'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1FLG_HVx86-RY6UbXX8w2rW1TEurUoJeq' },
                    { question: '¿Cuánto mide el perímetro de la línea azul, considera π=3.14?', options: ['a) 33.12 cm', 'b) 34.53 cm', 'c) 26.84 cm', 'd) 27.15 cm'], correct: 2, image: 'https://drive.google.com/thumbnail?id=14_4XR3p7OdY5cEfCEJiYUdf3-yHKMClI' },
                    { question: '¿Cuánto mide el perímetro de la parte roja, considera π=3.14?', options: ['a) 18.84 cm', 'b) 20.14 cm', 'c) 19.4 cm', 'd) 21.8 cm'], correct: 0, image: 'https://drive.google.com/thumbnail?id=1e4MVLCYbvmp38diwIJO9i8H0bR10HWS4' },
                    { question: '¿Cuánto mide el perímetro de la figura sombreada, considera π=3.14?', options: ['a) 20.14 cm', 'b) 18.84 cm', 'c) 19.4 cm', 'd) 21.8 cm'], correct: 1, image: 'https://drive.google.com/thumbnail?id=1DnLCVx4QPZ0rm1bP8RL8gFKOmVn78P-N' },
                    { question: '¿Cuánto mide el perímetro de la parte azul, considera π=3.14?', options: ['a) 21.12 cm', 'b) 21.58 cm', 'c) 21.42 cm', 'd) 21.76 cm'], correct: 2, image: 'https://drive.google.com/thumbnail?id=1UK_3du_qKGEC-f8-r7rG7R5yjjVII9J-' }
                ]
            },
            {
                id: 'lenguaje-algebraico',
                title: 'Lenguaje Algebraico',
                icon: 'https://drive.google.com/thumbnail?id=1Ow2_W0aQRTMaP4ooOyxPOFYhST_kAnpO',
                theme: {
                    bg: 'bg-purple-500',
                    text: 'text-white',
                    accent: 'bg-purple-700',
                    button: 'bg-purple-600 hover:bg-purple-800',
                    card: 'bg-purple-600',
                    ring: 'ring-purple-300'
                },
                questions: [
                    { question: 'El total de siete veces un número y 14 veces la diferencia entre el número y 21', options: ['a) 7n + 14(n - 21)', 'b) 7n + 14n - 21', 'c) 7n + 14(21 - n)', 'd) 7n - 14(n - 21)'], correct: 0, image: '' },
                    { question: 'Seis menos un tercio de la suma de un número y nueve', options: ['a) 6 - (n+9)/3', 'b) 6 - n/3 + 9', 'c) (6-n+9)/3', 'd) 6 - 1/3n + 9'], correct: 0, image: '' },
                    { question: 'Diez menos que el triple de la diferencia entre un número y 15', options: ['a) 3n - 15 - 10', 'b) 3(n - 15) - 10', 'c) 3(n - 15) + 10', 'd) 3n - 15 + 10'], correct: 1, image: '' },
                    { question: 'La mitad de un número incrementado en 8', options: ['a) n/2 + 8', 'b) (n+8)/2', 'c) n/2 - 8', 'd) 2n + 8'], correct: 0, image: '' },
                    { question: 'El doble de la suma de un número y 7', options: ['a) 2n + 7', 'b) 2(n + 7)', 'c) 2n + 14', 'd) n + 14'], correct: 1, image: '' },
                    { question: 'Cinco menos que el cuadrado de un número.', options: ['a) 5 - n²', 'b) n² - 5', 'c) (5 - n)²', 'd) (n - 5)²'], correct: 1, image: '' },
                    { question: 'Tres veces la diferencia entre un número y 4', options: ['a) 3n - 4', 'b) 3(n - 4)', 'c) 3(4 - n)', 'd) 3n + 4'], correct: 1, image: '' },
                    { question: 'Un número elevado al cuadrado más el doble del mismo número', options: ['a) n² + n', 'b) n² + 2n', 'c) (n + 2)²', 'd) 2n² + n'], correct: 1, image: '' },
                    { question: 'La tercera parte de un número disminuido en 6', options: ['a) n/3 - 6', 'b) (n-6)/3', 'c) 3n - 6', 'd) n-6/3'], correct: 0, image: '' },
                    { question: 'El producto de 4 y la suma de un número con 9', options: ['a) 4n + 9', 'b) 4(n + 9)', 'c) 4 + n + 9', 'd) 4n + 36'], correct: 1, image: '' }
                ]
            },
            {
                id: 'jerarquia-operaciones',
                title: 'Jerarquía de Operaciones',
                icon: 'https://drive.google.com/thumbnail?id=1nBU4DSqhgCN4olAW01afFoXlUmvgZzaR',
                theme: {
                    bg: 'bg-red-500',
                    text: 'text-white',
                    accent: 'bg-red-700',
                    button: 'bg-red-600 hover:bg-red-800',
                    card: 'bg-red-600',
                    ring: 'ring-red-300'
                },
                questions: [
                    { question: '¿Cuál es el resultado de la operación? {[(-4 + 6) × 3] - 5} ÷ (-1)', options: ['a) 1', 'b) -1', 'c) 3', 'd) -3'], correct: 1, image: '' },
                    { question: '¿Cuál es el resultado de la operación? [(-8÷2) + 5 ] × { 3 - [1 + (−2) ] }', options: ['a) 9', 'b) -3', 'c) 6', 'd) 4'], correct: 3, image: '' },
                    { question: '¿Cuál es el resultado de la operación? -3+ [4×(2-5)]-{-6÷2}', options: ['a) -6', 'b) -12', 'c) 0', 'd) -9'], correct: 1, image: '' },
                    { question: '¿Cuál es el resultado de la operación? {[(-10÷2) × (−3) ] + 4 } - [ (-8) ÷ (-4)]', options: ['a) 17', 'b) 15', 'c) 13', 'd) 11'], correct: 0, image: '' },
                    { question: '¿Cuál es el resultado de la operación? [(-6+2)×3] ÷ { 2 + [ 1 - (-1) ] }', options: ['a) -6', 'b) -3', 'c) 3', 'd) 6'], correct: 1, image: '' },
                    { question: '¿Cuál es el resultado de la operación? {[(-5-1)÷3] + 2 }× [4-(-2)]', options: ['a) 24', 'b) 0', 'c) 6', 'd) 4'], correct: 1, image: '' },
                    { question: '¿Cuál es el resultado de la operación? [(-12÷4) +5]×{-3-[-1-(-2)]}', options: ['a) 0', 'b) -4', 'c) 4', 'd) -8'], correct: 3, image: '' },
                    { question: '¿Cuál es el resultado de la operación? {[(-6÷2) + 4]×3} - [5 - (−1) ]', options: ['a) -3', 'b) 0', 'c) 3', 'd) 6'], correct: 0, image: '' },
                    { question: '¿Cuál es el resultado de la operación? [(-15÷5) + 2 ] × { 4 - [ 3 – (-1)]}', options: ['a) 0', 'b) -2', 'c) 2', 'd) -4'], correct: 0, image: '' },
                    { question: '¿Cuál es el resultado de la operación? {[(-10÷2) + 3 ] × (-2) } - [ (-4) ÷ (-2) ]', options: ['a) 4', 'b) 2', 'c) 8', 'd) 10'], correct: 1, image: '' }
                ]
            },
            {
                id: 'ecuaciones-lineales',
                title: 'Ecuaciones Lineales',
                icon: 'https://drive.google.com/thumbnail?id=1mgiCE1FPr0EOazTWViVxzpdN9dm_Os1X',
                theme: {
                    bg: 'bg-blue-500',
                    text: 'text-white',
                    accent: 'bg-blue-700',
                    button: 'bg-blue-600 hover:bg-blue-800',
                    card: 'bg-blue-600',
                    ring: 'ring-blue-300'
                },
                questions: [
                    { question: '¿Cuál es el valor de m en la ecuación? 3(m + 2) = 21', options: ['a) m = 3', 'b) m = 5', 'c) m = 7', 'd) m = 9'], correct: 1, image: '' },
                    { question: '¿Cuál es el valor de y en la ecuación? 2y - 4 = 3(y - 3)', options: ['a) y = 2', 'b) y = 3', 'c) y = 4', 'd) y = 5'], correct: 3, image: '' },
                    { question: '¿Cuál es el valor de z en la ecuación? (z-1)/2 + 3 = 7', options: ['a) z = 6', 'b) z = 7', 'c) z = 8', 'd) z = 9'], correct: 3, image: '' },
                    { question: '¿Cuál es el valor de a en la ecuación? 4a + 6 = 2(a + 8)', options: ['a) a = 3', 'b) a = 4', 'c) a = 5', 'd) a = 6'], correct: 2, image: '' },
                    { question: '¿Cuál es el valor de b en la ecuación? 5(b - 2) = 3b + 4', options: ['a) b = 6', 'b) b = 7', 'c) b = 8', 'd) b = 9'], correct: 1, image: '' },
                    { question: '¿Cuál es el valor de x en la ecuación? (2x+1)/3 = (x-2)/2', options: ['a) x = 2', 'b) x = -8', 'c) x = 7', 'd) x = 5'], correct: 1, image: '' },
                    { question: '¿Cuál es el valor de p en la ecuación? 6 - (p + 1) = 2p - 4', options: ['a) p = 2', 'b) p = 3', 'c) p = 4', 'd) p = 5'], correct: 1, image: '' },
                    { question: '¿Cuál es el valor de q en la ecuación? 3(q - 4) + 2 = 5(q - 2)', options: ['a) q = 1', 'b) q = 2', 'c) q = 0', 'd) q = 4'], correct: 2, image: '' },
                    { question: '¿Cuál es el valor de r en la ecuación? 2r + 5 = 3(r + 1) - 2', options: ['a) r = 2', 'b) r = 3', 'c) r = 4', 'd) r = 5'], correct: 2, image: '' },
                    { question: '¿Cuál es el valor de m en la ecuación? (m+2)/3 + 7 = m + 1', options: ['a) m = 8', 'b) m = 10', 'c) m = 11', 'd) m = 12'], correct: 1, image: '' }
                ]
            }
        ];

        const MathFormatter = ({ text }) => {
            if (!text || typeof text !== 'string') {
                return <span>{text}</span>;
            }

            const parts = text.split(/(\s+|\+|-|=)/).filter(Boolean);

            const formatPart = (part) => {
                // Mixed number: 1 2/10
                const mixedMatch = part.match(/^(\d+)\s(\d+)\/(\d+)$/);
                if (mixedMatch) {
                    return (
                        <span className="mixed-number">
                            <span>{mixedMatch[1]}</span>
                            <span className="fraction">
                                <span className="numerator">{mixedMatch[2]}</span>
                                <span className="denominator">{mixedMatch[3]}</span>
                            </span>
                        </span>
                    );
                }

                // Fraction with parenthesis: (2x+1)/3
                const parenMatch = part.match(/^\((.+)\)\/(\S+)$/);
                if (parenMatch) {
                    return (
                         <span className="fraction">
                            <span className="numerator">({parenMatch[1]})</span>
                            <span className="denominator">{parenMatch[2]}</span>
                        </span>
                    );
                }
                
                // Simple fraction: 7/14
                const simpleMatch = part.match(/^(\S+)\/(\S+)$/);
                 if (simpleMatch) {
                    return (
                         <span className="fraction">
                            <span className="numerator">{simpleMatch[1]}</span>
                            <span className="denominator">{simpleMatch[2]}</span>
                        </span>
                    );
                }

                return <span>{part}</span>;
            };

            return (
                <p>
                    {parts.map((part, index) => (
                        <React.Fragment key={index}>
                            {/(\s+|\+|-|=)/.test(part) ? <span>&nbsp;{part.trim()}&nbsp;</span> : formatPart(part)}
                        </React.Fragment>
                    ))}
                </p>
            );
        };
        
        const Header = () => (
            <header className="bg-white shadow-md p-6 flex flex-col items-center justify-center text-center">
                <div className="mb-4">
                    <img src="https://drive.google.com/thumbnail?id=1kHsPdkw6Tq4MsocpIqixwhsidsGqKcfU" alt="I learn math Logo" className="h-32 w-32 object-contain bg-indigo-100 p-2 rounded-full shadow-lg" />
                </div>
                <div>
                    <h1 className="text-4xl md:text-5xl font-bold text-black title-stroke">I learn math</h1>
                    <p className="text-gray-600 text-sm md:text-base mt-1">Creado por: Jairo Farrera</p>
                </div>
            </header>
        );

        const TopicMenu = ({ onSelectTopic }) => (
            <main className="p-4 sm:p-6 md:p-8">
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    {quizData.map((quiz) => (
                        <div key={quiz.id} 
                             className={`p-6 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-300 cursor-pointer flex flex-col items-center justify-center ${quiz.theme.card} ${quiz.theme.text}`}
                             onClick={() => onSelectTopic(quiz.id)}>
                            <img src={quiz.icon} alt={`${quiz.title} icon`} className="h-24 w-24 mb-4 object-contain rounded-full bg-white p-2" />
                            <h2 className="text-2xl font-bold text-center">{quiz.title}</h2>
                        </div>
                    ))}
                </div>
            </main>
        );

        const QuizView = ({ quizId, onBack, onFinish }) => {
            const quiz = quizData.find(q => q.id === quizId);
            const { theme } = quiz;
            const [shuffledQuestions, setShuffledQuestions] = useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [answers, setAnswers] = useState([]);
            const [selectedOption, setSelectedOption] = useState(null);
            const coinSoundRef = useRef(null);

            useEffect(() => {
                setShuffledQuestions(quiz.questions.map(value => ({ value, sort: Math.random() })).sort((a, b) => a.sort - b.sort).map(({ value }) => value));
                coinSoundRef.current = new Audio('https://freetousesounds.com/wp-content/uploads/2022/04/Coin-Sound-Effect.mp3');
            }, [quiz.questions]);

            const handleAnswerSelect = (optionIndex) => {
                if (selectedOption !== null) return;
                setSelectedOption(optionIndex);
                const newAnswers = [...answers];
                newAnswers[currentQuestionIndex] = optionIndex;
                setAnswers(newAnswers);
            };

            const handleNextQuestion = () => {
                if (selectedOption === null) return;

                if (coinSoundRef.current) {
                    coinSoundRef.current.currentTime = 0;
                    coinSoundRef.current.play().catch(e => console.error("Error playing sound:", e));
                }

                if (currentQuestionIndex < shuffledQuestions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                    setSelectedOption(null);
                } else {
                    onFinish(quizId, answers, shuffledQuestions);
                }
            };
            
            if (shuffledQuestions.length === 0) {
                return <div className="text-center p-10">Cargando quiz...</div>;
            }

            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            
            return (
                <div className={`min-h-screen ${theme.bg} ${theme.text}`}>
                    <div className="p-4 flex justify-between items-center">
                        <button onClick={onBack} className={`px-4 py-2 rounded-lg shadow-md ${theme.button} transition-colors`}>
                            ← Menú Principal
                        </button>
                        <div className={`${theme.accent} px-4 py-2 rounded-lg font-bold`}>
                            Pregunta {currentQuestionIndex + 1} / {shuffledQuestions.length}
                        </div>
                    </div>
                    <div className="p-4 md:p-8 max-w-4xl mx-auto">
                        <div className={`p-6 rounded-lg shadow-2xl ${theme.card}`}>
                            <h2 className="text-xl md:text-2xl font-bold mb-6 text-center">
                                <MathFormatter text={currentQuestion.question}/>
                            </h2>
                            {currentQuestion.image && (
                                <div className="mb-6 flex justify-center">
                                    <img src={currentQuestion.image} alt="Ilustración de la pregunta" className="w-full h-auto max-h-[45vh] object-contain rounded-lg shadow-lg bg-white p-4" />
                                </div>
                            )}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {currentQuestion.options.map((option, index) => {
                                    const isSelected = selectedOption === index;
                                    const isDimmed = selectedOption !== null && !isSelected;

                                    return (
                                        <button key={index}
                                            onClick={() => handleAnswerSelect(index)}
                                            className={`p-4 rounded-lg text-left transition-all duration-300 ${isDimmed ? 'opacity-50' : ''} ${isSelected ? `${theme.accent} ring-4 ${theme.ring}` : 'bg-white/20 hover:bg-white/30'} `}
                                            disabled={selectedOption !== null}>
                                            <MathFormatter text={option}/>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                        <div className="mt-8 text-center">
                            <button onClick={handleNextQuestion} disabled={selectedOption === null} className={`px-12 py-4 text-xl font-bold rounded-lg shadow-lg ${theme.button} disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105`}>
                                {currentQuestionIndex < shuffledQuestions.length - 1 ? 'Siguiente' : 'Finalizar'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const ResultsView = ({ quizId, userAnswers, questions, onBack }) => {
            const quiz = quizData.find(q => q.id === quizId);
            const { theme } = quiz;

            const score = useMemo(() => {
                return questions.reduce((acc, question, index) => {
                    return userAnswers[index] === question.correct ? acc + 1 : acc;
                }, 0);
            }, [userAnswers, questions]);

            const [studentName, setStudentName] = useState('');
            const [generatedLink, setGeneratedLink] = useState('');
            const [isCopied, setIsCopied] = useState(false);

            const handleGenerateLink = () => {
                if (!studentName.trim()) return;
                const dataToEncode = {
                    quizId,
                    score,
                    total: questions.length,
                    name: studentName.trim()
                };
                const jsonString = JSON.stringify(dataToEncode);
                const base64String = btoa(unescape(encodeURIComponent(jsonString)));
                const encodedData = encodeURIComponent(base64String);

                const url = `${window.location.origin}${window.location.pathname}?verify=${encodedData}`;
                setGeneratedLink(url);
                setIsCopied(false);
            };

            const handleCopyLink = () => {
                navigator.clipboard.writeText(generatedLink).then(() => {
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                });
            };

            return (
                 <div className={`min-h-screen ${theme.bg} ${theme.text} flex flex-col items-center justify-center p-4`}>
                    <div className={`${theme.card} p-8 rounded-2xl shadow-2xl text-center max-w-lg w-full`}>
                        <h2 className="text-4xl font-bold mb-2">¡Resultados!</h2>
                        <p className="text-xl mb-4">Completaste el quiz de "{quiz.title}"</p>
                        <div className={`${theme.accent} inline-block px-8 py-4 rounded-full my-4`}>
                            <p className="text-5xl font-bold">{score} / {questions.length}</p>
                        </div>
                        <p className="text-lg mt-4 mb-6">
                            {score > 7 ? '¡Excelente trabajo! Sigue así.' : (score > 4 ? '¡Buen esfuerzo! La práctica hace al maestro.' : '¡No te rindas! Cada intento es un paso adelante.')}
                        </p>

                        <div className="mt-6 pt-6 border-t border-white/30">
                           <h3 className="text-2xl font-bold mb-4">Comparte tu resultado</h3>
                           <input 
                               type="text"
                               value={studentName}
                               onChange={(e) => setStudentName(e.target.value)}
                               placeholder="Escribe tu nombre aquí"
                               className={`w-full p-3 rounded-lg bg-white text-gray-800 placeholder-gray-500 ${theme.ring} focus:ring-4 outline-none transition-all`}
                           />
                           <button onClick={handleGenerateLink} disabled={!studentName.trim()} className={`w-full mt-3 px-6 py-3 font-bold rounded-lg shadow-md ${theme.button} disabled:opacity-50 transition-colors`}>
                               Generar Link
                           </button>
                           {generatedLink && (
                               <div className="mt-4">
                                   <p className="text-sm break-all bg-black/20 p-2 rounded-md">{generatedLink}</p>
                                   <button onClick={handleCopyLink} className={`w-full mt-2 px-6 py-3 font-bold rounded-lg shadow-md ${theme.button} transition-colors`}>
                                       {isCopied ? '¡Copiado!' : 'Copiar Link'}
                                   </button>
                               </div>
                           )}
                        </div>

                        <button onClick={onBack} className={`mt-8 px-8 py-3 font-bold rounded-lg shadow-md ${theme.button} transition-colors`}>
                            Volver al Menú
                        </button>
                    </div>
                </div>
            );
        };
        
        const VerificationView = ({ verificationData }) => {
            const { quizId, score, total, name } = verificationData;
            const quiz = quizData.find(q => q.id === quizId);
            if (!quiz) {
                return (
                    <div className="min-h-screen bg-red-500 text-white flex flex-col items-center justify-center p-4">
                        <h2 className="text-3xl font-bold">Error de Verificación</h2>
                        <p>No se encontró el quiz correspondiente.</p>
                    </div>
                );
            }
            const { theme } = quiz;
            
            return (
                <div className={`min-h-screen ${theme.bg} ${theme.text} flex flex-col items-center justify-center p-4`}>
                    <div className={`${theme.card} p-8 rounded-2xl shadow-2xl text-center max-w-lg w-full`}>
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-20 w-20 mx-auto mb-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                        </svg>
                        <h2 className="text-3xl font-bold mb-2">Resultado Verificado</h2>
                        <p className="text-2xl font-bold text-yellow-300 break-words bg-black/20 p-2 rounded-md">{name}</p>
                        <p className="text-lg mt-4">Completó el quiz:</p>
                        <p className="text-xl font-bold mb-4">{quiz.title}</p>
                        <div className={`${theme.accent} inline-block px-8 py-4 rounded-full my-4`}>
                            <p className="text-5xl font-bold">{score} / {total}</p>
                        </div>
                         <a href={window.location.origin + window.location.pathname} className={`mt-8 inline-block px-8 py-3 font-bold rounded-lg shadow-md ${theme.button} transition-colors`}>
                            Crear mi propio quiz
                        </a>
                    </div>
                </div>
            )
        }

        const App = () => {
            const [view, setView] = useState('menu');
            const [quizId, setQuizId] = useState(null);
            const [quizResult, setQuizResult] = useState(null);
            const [verificationData, setVerificationData] = useState(null);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const verifyParam = params.get('verify');
                if (verifyParam) {
                    try {
                        const decodedB64 = decodeURIComponent(verifyParam);
                        const jsonString = decodeURIComponent(escape(atob(decodedB64)));
                        const data = JSON.parse(jsonString);
                        setVerificationData(data);
                        setView('verify');
                    } catch (error) {
                        console.error("Error decoding verification data:", error);
                        // Invalid data, go to menu
                        window.history.replaceState({}, document.title, window.location.pathname);
                        setView('menu');
                    }
                }
            }, []);

            const handleSelectTopic = (id) => {
                setQuizId(id);
                setView('quiz');
            };

            const handleFinishQuiz = (id, answers, questions) => {
                setQuizResult({ quizId: id, userAnswers: answers, questions });
                setView('results');
            };

            const handleGoHome = () => {
                setView('menu');
                setQuizId(null);
                setQuizResult(null);
                 if (window.location.search) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            };

            const renderView = () => {
                switch (view) {
                    case 'quiz':
                        return <QuizView quizId={quizId} onBack={handleGoHome} onFinish={handleFinishQuiz} />;
                    case 'results':
                        return <ResultsView {...quizResult} onBack={handleGoHome} />;
                    case 'verify':
                        return <VerificationView verificationData={verificationData} />;
                    case 'menu':
                    default:
                        return (
                            <>
                                <Header />
                                <TopicMenu onSelectTopic={handleSelectTopic} />
                            </>
                        );
                }
            };

            return <div className="min-h-screen">{renderView()}</div>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
